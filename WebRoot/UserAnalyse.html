<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<title>后台模板</title>
<link rel="stylesheet" href="assets/css/amazeui.css" />
<link rel="stylesheet" href="assets/css/core.css" />
<link rel="stylesheet" href="assets/css/menu.css" />
<link rel="stylesheet" href="assets/css/index.css" />
<link rel="stylesheet" href="assets/css/admin.css" />
<link rel="stylesheet" href="assets/css/page/typography.css" />
<link rel="stylesheet" href="assets/css/page/form.css" />
<link rel="stylesheet" href="assets/css/component.css" />

</head>
<body>
	<!-- Begin page -->
	<header class="am-topbar am-topbar-fixed-top">
		<div class="am-topbar-left am-hide-sm-only">
			<a href="index.html" class="logo"><span>Easy<span>Bike</span>
			</span><i class="zmdi zmdi-layers"></i> </a>
		</div>

		<div class="contain">
			<ul class="am-nav am-navbar-nav am-navbar-left">

				<li><h4 class="page-title">單用戶分析</h4></li>
			</ul>

			<ul class="am-nav am-navbar-nav am-navbar-right">
				<li class="inform"><i class="am-icon-bell-o" aria-hidden="true"></i>
				</li>
				<li class="hidden-xs am-hide-sm-only">
					<form role="search" class="app-search">
						<input type="text" placeholder="Search..." class="form-control">
						<a href=""><img src="assets/img/search.png"> </a>
					</form>
				</li>
			</ul>
		</div>
	</header>
	<!-- end page -->


	<div class="admin">
		<!--<div class="am-g">-->
		<!-- ========== Left Sidebar Start ========== -->
		<!--<div class="left side-menu am-hide-sm-only am-u-md-1 am-padding-0">
			<div class="slimScrollDiv" style="position: relative; overflow: hidden; width: auto; height: 548px;">
				<div class="sidebar-inner slimscrollleft" style="overflow: hidden; width: auto; height: 548px;">-->
		<!-- sidebar start -->
		<div class="admin-sidebar am-offcanvas  am-padding-0"
			id="admin-offcanvas" style="overflow-y: hidden;">
			<div class="am-offcanvas-bar admin-offcanvas-bar">
				<!-- User -->
				<div class="user-box am-hide-sm-only">
					<div class="user-img">
						<img src="assets/img/avatar-1.jpg" alt="user-img"
							title="Mat Helme" class="img-circle img-thumbnail img-responsive">
						<div class="user-status offline">
							<i class="am-icon-dot-circle-o" aria-hidden="true"></i>
						</div>
					</div>
					<h5>
						<a href="#">管理员</a>
					</h5>
					<ul class="list-inline">
						<li><a href="#"> <i class="fa fa-cog" aria-hidden="true"></i>
						</a></li>

						<li><a href="#" class="text-custom"> <i class="fa fa-cog"
								aria-hidden="true"></i>
						</a></li>
					</ul>
				</div>
				<!-- End User -->

				<ul class="am-list admin-sidebar-list">
					<li><a href="index.html"><span class="am-icon-home"></span>
							首页</a></li>
					<li class="admin-parent"><a class="am-cf"
						data-am-collapse="{target: '#collapse-nav1'}"><span
							class="am-icon-line-chart"></span> 单车管理 <span
							class="am-icon-angle-right am-fr am-margin-right"></span> </a>
						<ul class="am-list am-collapse admin-sidebar-sub am-in"
							id="collapse-nav1">
							<li><a href="BikeManage.html" class="am-cf"> 单车位置
							</a></li>
							<li><a href="TraceManage.html">轨迹管理</a></li>
						</ul></li>
					<li class="admin-parent"><a class="am-cf"
						data-am-collapse="{target: '#collapse-nav2'}"><span
							class="am-icon-line-chart"></span> 用户管理 <span
							class="am-icon-angle-right am-fr am-margin-right"></span> </a>
						<ul class="am-list am-collapse admin-sidebar-sub am-in"
							id="collapse-nav2">
							<li><a href="UserStatistics.html" class="am-cf"> 统计信息
							</a></li>
							<li><a href="UserManage.html">用户列表</a></li>
						</ul></li>
					<li><a href="RepairManage.html"><span class="am-icon-file"></span>
							维修管理</a></li>
					<li><a href="mobikeAnalysis.html"><span class="am-icon-file"></span>
					摩拜单车数据分析</a></li>
					<li><a href="AccusationManage.html"><span class="am-icon-file"></span>
					举报管理</a></li>
				</ul>
			</div>
		</div>
		
		<!-- Start right Content here -->
		<div class="content-page">
			<!-- Start content -->
			<div class="content">
			
				<div class="am-u-md-12">
					<div class="card-box">
					<h3>&nbsp;&nbsp;&nbsp;&nbsp;用戶起點及目的地</h3>
						<div class="am-g">
							<!-- Row start -->
							<div class="am-u-md-12">
								<div id="mapContainer" style="width:100%; height:500px"></div>
							</div>
						</div>
						<!-- Row end -->
					</div>
				</div>
				<div class="am-u-md-5">
					<div class="card-box">
						<div id="usetimechart" style="width: 600px;height:400px;"></div>
						<hr/>
						<p id = "time1"></p>
					</div>
				</div>
				<div class="am-u-md-6">
					<div class="card-box">
						<div id="usetimelengthchart" style="width: 600px;height:400px;"></div>
						<hr/>
						<p id = "time2"></p>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end right Content here -->

	<!-- navbar -->
	<a href="admin-offcanvas"
		class="am-icon-btn am-icon-th-list am-show-sm-only admin-menu"
		data-am-offcanvas="{target: '#admin-offcanvas'}"> <!--<i class="fa fa-bars" aria-hidden="true"></i>-->
	</a>

	<script type="text/javascript" src="assets/js/jquery-2.1.0.js"></script>
	<script type="text/javascript" src="assets/js/amazeui.min.js"></script>
	<script type="text/javascript" src="assets/js/app.js"></script>
	<script type="text/javascript" src="assets/js/blockUI.js"></script>
	<script type="text/javascript" src="assets/js/charts/echarts.min.js"></script>
	<script type="text/javascript" src="assets/js/charts/indexChart.js"></script>
	<script charset="utf-8"
		src="http://api.map.baidu.com/api?v=2.0&ak=oVdoUZCVMdvV94D5kAmVCtmRP0Wifzai"></script>

	<script type="text/javascript">
		var map;
		function init() {
			map = new BMap.Map("mapContainer"); // 创建地图实例  
			var point = new BMap.Point(121.409888, 31.235534); // 创建点坐标  
			map.centerAndZoom(point, 20); // 初始化地图，设置中心点坐标和地图级别  
			map.addControl(new BMap.NavigationControl());
			map.addControl(new BMap.ScaleControl());
			map.addControl(new BMap.OverviewMapControl());
			map.addControl(new BMap.MapTypeControl());
			map.enableScrollWheelZoom(); // 启动鼠标滚轮操作
		}
	
		$(window)
			.on(
				'load',
				function() {
					init();
					initMap();
					setChart();
					setChart2();
					getCurrentTime();
				});
	</script>
	<script type="text/javascript">
		function GetRequest() {
			var url = location.search; //获取url中"?"符后的字串
			var theRequest = new Object();
			if (url.indexOf("?") != -1) {
				var str = url.substr(1);
				strs = str.split("&");
				for (var i = 0; i < strs.length; i++) {
					theRequest[strs[i].split("=")[0]] = decodeURIComponent(strs[i].split("=")[1]);
				}
			}
			return theRequest;
		}
	</script>
	
	<script type="text/javascript">
	function initMap(){
		$
				.ajax({
					url : "http://localhost:8080/easybike/restful/user/getRideBeginAndEnd",
					type : "post",
					dataType : "json",
					data : {
						"userid" : GetRequest()["userid"]
					},
					success : function(result) {
						var r = result;
						var obj = r.obj;
						var retcode = r.retcode;
						var errorMsg = r.errorMsg;
						if (retcode != "0000") {
							alert(errorMsg);
						} else {
							$
								.each(
									obj,
									function(
										index,
										item) {
										var points=new Array();
										if(item.positionByStartPoint==null||item.positionByEndPoint==null)
											return true; 
										points[0]=new BMap.Point(
											item.positionByStartPoint.longitude,
											item.positionByStartPoint.latitude);
										points[1]=new BMap.Point(
										item.positionByEndPoint.longitude,
										item.positionByEndPoint.latitude);
										polyline = new BMap.Polyline(points, {
											strokeColor : "blue",
											strokeWeight : 1,
											strokeOpacity : 0.5
										});
										map.addOverlay(polyline);
										var myIcon1 = new BMap.Icon("http://115.159.122.41:8080/easybike/assets/img/start.png",
													new BMap.Size(50, 50));
										var marker1 = new BMap.Marker(points[0], {
													icon : myIcon1
												}); // 创建标注
										map.addOverlay(marker1); // 将标注添加到地图中
										var myIcon2 = new BMap.Icon("http://115.159.122.41:8080/easybike/assets/img/end.png",
													new BMap.Size(50, 50));
										var marker2 = new BMap.Marker(points[1], {
													icon : myIcon2
												}); // 创建标注
										map.addOverlay(marker2); // 将标注添加到地图中
										if (index == obj.length-1) map.setCenter(points[0]);
									})
							setChart(node);
						}
					}
				});
	}
	</script>
	
	<script type="text/javascript">
	//初始化图表	“最近一周用车情况”
	function setChart(){
	        // 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('usetimechart'));

        // 指定图表的配置项和数据
        var option = {
		    title: {
		        text: '最近一周用车情况'
		    },
		    tooltip: {
		        trigger: 'axis'
		    },
		    xAxis: {
		        type: 'category',
		        boundaryGap: false,
		        data: ['周一','周二','周三','周四','周五','周六','周日']
		    },
		    yAxis: {
		        type: 'value'
		    }
		};

        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);
        
        //動態設置數據
         myChart.showLoading();
        getChartData(myChart);
        
        }
	</script>

	<script type = "text/javascript">
	function getChartData(myChart){
	$
		.ajax({
			url : "http://localhost:8080/easybike/restful/user/userRideTimes",
			type : "post",
			dataType : "json",
			data : {
				"userid" : GetRequest()["userid"]
			},
			success : function(result) {
				var r = result;
				var obj = r.obj;
				var retcode = r.retcode;
				var errorMsg = r.errorMsg;
				if (retcode != "0000") {
					alert(errorMsg);
				} else {
					myChart.setOption({
					    series: [
					        {
					            name:'使用次数',
					            type:'line',
					            stack: '总次数',
					            data:[obj[1].times, obj[2].times, obj[3].times, obj[4].times, obj[5].times, obj[6].times, obj[0].times]
					        }
					    ]
				    });
				    myChart.hideLoading();
				}
			}
		});
	}
	</script>

	<script type="text/javascript">
	//初始化图表	“用車時長統計”
	function setChart2(){
	        // 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('usetimelengthchart'));

        // 指定图表的配置项和数据
        var option = {
		    title : {
		        text: '用車時長統計',
		        x:'center'
		    },
		    tooltip : {
		        trigger: 'item',
		        formatter: "{a} <br/>{b} : {c} ({d}%)"
		    },
		    series : [
		        {
		            name: '骑行时长',
		            type: 'pie',
		            radius : '55%',
		            center: ['50%', '60%'],
		            
		            itemStyle: {
		                emphasis: {
		                    shadowBlur: 10,
		                    shadowOffsetX: 0,
		                    shadowColor: 'rgba(0, 0, 0, 0.5)'
		                }
		            }
		        }
		    ]
		};
        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);
        
        //動態設置數據
        myChart.showLoading();
        getChartData2(myChart);
        
       }
	</script>
	
	<script type="text/javascript">
	function getChartData2(myChart){
	$
		.ajax({
			url : "http://localhost:8080/easybike/restful/user/getBikeUseTime",
			type : "post",
			dataType : "json",
			data : {
				"userid" : GetRequest()["userid"]
			},
			success : function(result) {
				var r = result;
				var obj = r.obj;
				var retcode = r.retcode;
				var errorMsg = r.errorMsg;
				if (retcode != "0000") {
					alert(errorMsg);
				} else {
					myChart.setOption({
					    series: [
					        {
					            data:[
					                {value:obj[0].times, name:obj[0].timeZone},
					                {value:obj[1].times, name:obj[1].timeZone},
					                {value:obj[2].times, name:obj[2].timeZone},
					                {value:obj[3].times, name:obj[3].timeZone},
					                {value:obj[4].times, name:obj[4].timeZone},
					                {value:obj[5].times, name:obj[5].timeZone},
					                {value:obj[6].times, name:obj[6].timeZone},
					                {value:obj[7].times, name:obj[7].timeZone},
					                {value:obj[8].times, name:obj[8].timeZone}
					            ]
					        }
					    ]
				    	});
				    myChart.hideLoading();
				}
			}
		});
	}
	</script>
	
	<script type="text/javascript">
	function getCurrentTime(){
		var now=new Date(); 
		$("#time1").text("統計時間："+(parseInt(1900)+ parseInt(now.getYear()))+"-"+now.getDate()+" "+now.getHours()+":"+now.getMinutes()+":"+now.getSeconds());
		$("#time2").text("統計時間："+ (parseInt(1900)+ parseInt(now.getYear()))+"-"+(now.getMonth()+1)+"-"+now.getDate()+" "+now.getHours()+":"+now.getMinutes()+":"+now.getSeconds());
	}
	</script>
</body>
</html>