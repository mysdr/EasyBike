<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>后台模板</title>
<link rel="stylesheet" href="assets/css/amazeui.css" />
<link rel="stylesheet"
	href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
<link rel="stylesheet" href="assets/css/core.css" />
<link rel="stylesheet" href="assets/css/menu.css" />
<link rel="stylesheet" href="assets/css/index.css" />
<link rel="stylesheet" href="assets/css/admin.css" />
<link rel="stylesheet" href="assets/css/page/typography.css" />
<link rel="stylesheet" href="assets/css/page/form.css" />

<!--  引入高德地图api -->
<script type="text/javascript"
	src="http://webapi.amap.com/maps?v=1.3&key=bef6d4f09241ab4cd125beaedf2ff028&plugin=AMap.AdvancedInfoWindow"></script>

<!-- 引入 ECharts 文件 -->
<script src="echarts.min.js"></script>
</head>
<body>
	<!-- Begin page -->
	<header class="am-topbar am-topbar-fixed-top">
		<div class="am-topbar-left am-hide-sm-only">
			<a href="index.html" class="logo"><span>Easy<span>Bike</span>
			</span><i class="zmdi zmdi-layers"></i> </a>
		</div>

		<div class="contain">
			<ul class="am-nav am-navbar-nav am-navbar-left">

				<li><h4 class="page-title">维修管理</h4></li>
			</ul>

			<ul class="am-nav am-navbar-nav am-navbar-right">
				<li class="inform"><i class="am-icon-bell-o" aria-hidden="true"></i>
				</li>
				<li class="hidden-xs am-hide-sm-only">
					<form role="search" class="app-search">
						<input type="text" placeholder="Search..." class="form-control">
						<a href=""><img src="../assets/img/search.png"> </a>
					</form>
				</li>
			</ul>
		</div>
	</header>
	<!-- end page -->



	<div class="admin">
		<!--<div class="am-g">-->
		<!-- ========== Left Sidebar Start ========== -->
		<!--<div class="left side-menu am-hide-sm-only am-u-md-1 am-padding-0">
			<div class="slimScrollDiv" style="position: relative; overflow: hidden; width: auto; height: 548px;">
				<div class="sidebar-inner slimscrollleft" style="overflow: hidden; width: auto; height: 548px;">-->
		<!-- sidebar start -->
		<div class="admin-sidebar am-offcanvas  am-padding-0"
			id="admin-offcanvas" style="overflow-y: hidden;">
			<div class="am-offcanvas-bar admin-offcanvas-bar">
				<!-- User -->
				<div class="user-box am-hide-sm-only">
					<div class="user-img">
						<img src="assets/img/avatar-1.jpg" alt="user-img"
							title="Mat Helme" class="img-circle img-thumbnail img-responsive">
						<div class="user-status offline">
							<i class="am-icon-dot-circle-o" aria-hidden="true"></i>
						</div>
					</div>
					<h5>
						<a href="#">管理员</a>
					</h5>
					<ul class="list-inline">
						<li><a href="#"> <i class="fa fa-cog" aria-hidden="true"></i>
						</a></li>

						<li><a href="#" class="text-custom"> <i class="fa fa-cog"
								aria-hidden="true"></i> </a></li>
					</ul>
				</div>
				<!-- End User -->


								<ul class="am-list admin-sidebar-list">
					<li><a href="index.html"><span class="am-icon-home"></span>
							首页</a></li>
					<li class="admin-parent"><a class="am-cf"
						data-am-collapse="{target: '#collapse-nav1'}"><span
							class="am-icon-line-chart"></span> 单车管理 <span
							class="am-icon-angle-right am-fr am-margin-right"></span> </a>
						<ul class="am-list am-collapse admin-sidebar-sub am-in"
							id="collapse-nav1">
							<li><a href="BikeManage.html" class="am-cf"> 单车位置
							</a></li>
							<li><a href="TraceManage.html">投放推荐</a></li>
						</ul></li>
					<li class="admin-parent"><a class="am-cf"
						data-am-collapse="{target: '#collapse-nav2S'}"><span
							class="am-icon-line-chart"></span> 用户管理 <span
							class="am-icon-angle-right am-fr am-margin-right"></span> </a>
						<ul class="am-list am-collapse admin-sidebar-sub am-in"
							id="collapse-nav2">
							<li><a href="UserStatistics.html" class="am-cf"> 统计信息
							</a></li>
							<li><a href="UserManage.html">用户列表</a></li>
						</ul></li>
					<li><a href="RepairManage.html"><span class="am-icon-file"></span>
							维修管理</a></li>
					<li><a href="mobikeAnalysis.html"><span class="am-icon-file"></span>
					摩拜单车移动轨迹</a></li>
				</ul>
			</div>
		</div>
		<!-- sidebar end -->

		<!--</div>
			</div>
		</div>-->
		<!-- ========== Left Sidebar end ========== -->



		<!--	<div class="am-g">-->
		<!-- ============================================================== -->
		<!-- Start right Content here -->
		<div class="content-page">
			<!-- Start content -->
			<div class="content">
				<div class="card-box">
					<!-- Row start -->

					<div class="am-u-md-12">
						<div id="container" style="width:100%; height:500px"></div>
					</div>
					<div class="am-g">
						<div class="am-u-sm-12 am-u-md-6">
							<div class="am-btn-toolbar">
								<div class="am-btn-group am-btn-group-xs">
									<button type="button" class="am-btn am-btn-default">
										<span class="am-icon-plus"></span> 新增
									</button>
									<button type="button" class="am-btn am-btn-default">
										<span class="am-icon-save"></span> 保存
									</button>
									<button type="button" class="am-btn am-btn-default">
										<span class="am-icon-archive"></span> 审核
									</button>
									<button type="button" class="am-btn am-btn-default">
										<span class="am-icon-trash-o"></span> 删除
									</button>
								</div>
							</div>
						</div>

						<!--分页 开始！！！！ -->
						<div class="am-u-sm-12 am-u-md-3">
							<div class="am-input-group am-input-group-sm">
								<input type="text" class="am-form-field" id="pages"> <span
									class="am-input-group-btn">
									<button class="am-btn am-btn-default" type="button"
										onclick="initTable()">跳转到</button>
								</span>
							</div>
						</div>
						<!--分页 jieshu！！！！ -->
					</div>
					<!-- Row end -->

					<!-- Row start -->
					<div class="am-g">
						<div class="am-u-sm-12">
							<form class="am-form">
								<table
									class="am-table am-table-striped am-table-hover table-main">
									<thead>
										<tr>
											<th class="table-date am-hide-sm-only">维修ID</th>
											<th class="table-date am-hide-sm-only">单车号</th>
											<th class="table-date am-hide-sm-only">单车类型</th>
											<th class="table-date am-hide-sm-only">单车位置</th>
											<th class="table-author am-hide-sm-only">报修信息</th>
											<th class="table-author am-hide-sm-only">报修时间</th>
											<th class="table-date am-hide-sm-only">维修时间</th>
											<th class="table-date am-hide-sm-only">保修用户(ID)</th>
											<th class="table-date am-hide-sm-only">附加信息</th>
											<th class="table-set">维修</th>
											<th class="table-set">损毁</th>
										</tr>
									</thead>
									<tbody id="usertbody">

									</tbody>
								</table>
								<div class="am-cf">
									共 15 条记录
									<div class="am-fr">
										<ul class="am-pagination">
											<li class="am-disabled"><a href="#">«</a></li>
											<li class="am-active"><a href="#">1</a></li>
											<li><a href="#">2</a></li>
											<li><a href="#">3</a></li>
											<li><a href="#">4</a></li>
											<li><a href="#">5</a></li>
											<li><a href="#">»</a></li>
										</ul>
									</div>
								</div>
								<hr />
								<p>每月维修车辆</p>
							</form>
						</div>

					</div>
					<!-- 为 ECharts 准备一个具备大小（宽高）的 DOM -->
					<div id="charttt" style="width: 1200px;height:400px;"></div>
					<script type="text/javascript">
						var myChart = echarts.init(document
								.getElementById('charttt'));
						// 指定图表的配置项和数据
						var option = {
							color : [ '#3398DB' ],
							tooltip : {
								trigger : 'axis',
								axisPointer : { // 坐标轴指示器，坐标轴触发有效
									type : 'shadow' // 默认为直线，可选为：'line' | 'shadow'
								}
							},
							grid : {
								left : '3%',
								right : '4%',
								bottom : '3%',
								containLabel : true
							},
							xAxis : [ {
								type : 'category',
								data : [ '一月', '二月', '三月', '四月', '五月', '六月',
										'七月', '八月', '九月', '十月', '十一月', '十二月' ],
								axisTick : {
									alignWithLabel : true
								}
							} ],
							yAxis : [ {
								type : 'value'
							} ],
							series : [ {
								name : '维修车辆数',
								type : 'bar',
								barWidth : '60%',
								data : [ 10, 52, 200, 334, 590, 330, 220, 10,
										52, 334, 390, 330 ]
							} ]
						};

						// 使用刚指定的配置项和数据显示图表。
						myChart.setOption(option);
					</script>
					<!-- Row end -->

				</div>




			</div>


		</div>
	</div>
	<!-- end right Content here -->
	<!--</div>-->
	</div>
	</div>
	<div id='canvasDiv'></div>
	<!-- navbar -->
	<a href="admin-offcanvas"
		class="am-icon-btn am-icon-th-list am-show-sm-only admin-menu"
		data-am-offcanvas="{target: '#admin-offcanvas'}"> <!--<i class="fa fa-bars" aria-hidden="true"></i>-->
	</a>

	<script type="text/javascript" src="assets/js/jquery-2.1.0.js"></script>
	<script type="text/javascript" src="assets/js/amazeui.min.js"></script>
	<script type="text/javascript" src="assets/js/app.js"></script>
	<script type="text/javascript" src="assets/js/blockUI.js"></script>

	<script type="text/javascript">
		var gmap;
		
		
		function init() {
			gmap = new AMap.Map('container', {
				resizeEnable : true,
				zoom : 16,
				center : [ 121.403316, 31.229611 ]
			});
			gmap.plugin([ "AMap.ToolBar" ], function() {
				gmap.addControl(new AMap.ToolBar());
			});
		}

		$(window).on('load', function() {
			init();
		});
	</script>
	<script type="text/javascript">
		function showTheLocation(node) {
			var latitude = node.attr("latitude");
			var longtitude = node.attr("longtitude");
			gmap.setZoom(17);
            gmap.setCenter( [longtitude,
															latitude ]);
		}
	</script>
	<script type="text/javascript">
		function finishRepair(node) {
			$
					.ajax({
						url : "http://localhost:8080/easybike/restful/repair/updateRepairInfo",
						type : "post",
						data : {
							"repaidId" : node.attr("data"),
							"bikeId" : node.attr("data2")
						},
						dataType : "json",
						success : function(result) {
							var r = result;
							var obj = r.obj;
							var retcode = r.retcode;
							var errorMsg = r.errorMsg;
							if (retcode == "0001") {
								alert(errorMsg);
								return;
							} else {
								alert("维修信息提交成功！");
							}
						}
					});
		}
	</script>
	<script type="text/javascript">
		function abandonRepair(node) {
			$
					.ajax({
						url : "http://localhost:8080/easybike/restful/repair/updateRepairInfoBad",
						type : "post",
						data : {
							"repaidId" : node.attr("data"),
							"bikeId" : node.attr("data2")
						},
						dataType : "json",
						success : function(result) {
							var r = result;
							var obj = r.obj;
							var retcode = r.retcode;
							var errorMsg = r.errorMsg;
							if (retcode == "0001") {
								alert(errorMsg);
								return;
							} else {
								alert("车辆报废信息提交成功！");
							}
						}
					});
		}
	</script>

	<script type="text/javascript">
		function initMaps() {
			$
					.ajax({
						url : "http://localhost:8080/easybike/restful/repair/getRepairInfo",
						type : "post",
						dataType : "json",
						success : function(result) {
							var r = result;
							var obj = r.obj;
							var retcode = r.retcode;
							var errorMsg = r.errorMsg;
							if (retcode == "0001") {
								alert(errorMsg);
								return;
							}
							$
									.each(
											obj,
											function(index, item) {
												var gmarker = new AMap.Marker({
													position : [ item.longitude,
															item.latitude ],
													icon: new AMap.Icon({            
            size: new AMap.Size(50, 50),  //图标大小
            image: "http://localhost:8080/easybike/assets/img/bike_marker.png"
        })        												});
												gmarker.setMap(gmap);
											});
						}
					});
		}
	</script>
	<script type="text/javascript">
		function initTable() {
		var pages = $("#pages").val();
			var re = /^[0-9]+.?[0-9]*$/; //判断字符串是否为数字 //判断正整数 /^[1-9]+[0-9]*]*$/ 	
			if (!re.test(pages)) {
				layer.alert("请输入数字");
				return false;
			}
			$
					.ajax({
						url : "http://localhost:8080/easybike/restful/repair/getRepairInfoByPage",
						type : "post",
						dataType : "json",
						data : {
						"PNO":pages,
						"PSIZE":"4"
						},
						success : function(result) {
							var r = result;
							var obj = r.obj;
							var retcode = r.retcode;
							var errorMsg = r.errorMsg;
							if (retcode == "0001") {
								alert(errorMsg);
								return;
							}
							$("#usertbody").empty(); 
							$
									.each(
											obj,
											function(index, item) {
						
												var shtml = "<tr><td class='am-hide-sm-only'>"
														+ item.repairId
														+ "</td>"
														+ "<td class='am-hide-sm-only'>"
														+ item.bikeId
														+ "</td>"
														+ "<td class='am-hide-sm-only'>"
														+ item.type
														+ "</td>"
														+ "<td class='am-hide-sm-only'><span style='text-decoration: underline;color:#00F;cursor:pointer' onclick='showTheLocation($(this));' latitude='"
														+ item.latitude
														+ "' longtitude='"
														+ item.longitude
														+ "'>("
														+ item.latitude
														+ ","
														+ item.longitude
														+ ")</span></td>"
														+ "<td class='am-hide-sm-only'>"
														+ item.repairInformation
														+ "</td>"
														+ "<td class='am-hide-sm-only'>"
														+ changeTime(item.reportTime)
														+ "</td>";
												if (item.repairTime != null)
													shtml += "<td class='am-hide-sm-only'>"
															+ changeTime(item.repairTime)
															+ "</td>";
												else
													shtml += "<td class='am-hide-sm-only'>暂未维修</td>";
												shtml += "<td class='am-hide-sm-only'>"
														+ item.name
														+ "("
														+ item.userId
														+ ")</td>"
														+ "<td class='am-hide-sm-only'>"
														+ item.addinfo
														+ "</td>"
														+ "<td><img src='assets/img/BikeGetRepaired.png' style='cursor:pointer;'   title='维修完成' alt='维修完成' data='"
														+ item.repairId
														+ "' data2='"
														+ item.bikeId
														+ "' onclick='finishRepair($(this));'/></td>"
														+ "<td><img src='assets/img/BikeGetBroked.png'  style='cursor:pointer;'  title='该车损毁' alt='该车损毁' data='"
														+ item.repairId
														+ "' data2='"
														+ item.bikeId
														+ "'onclick='abandonRepair($(this));'/></td>";
												$("#usertbody").append(shtml);
											});
						}
					});
		}
	</script>

	<script type="text/javascript">
		function finishRepair(node) {
			$
					.ajax({
						url : "http://localhost:8080/easybike/restful/repair/updateRepairInfo",
						type : "post",
						data : {
							"repaidId" : node.attr("data"),
							"bikeId" : node.attr("data2")
						},
						dataType : "json",
						success : function(result) {
							var r = result;
							var obj = r.obj;
							var retcode = r.retcode;
							var errorMsg = r.errorMsg;
							if (retcode == "0001") {
								alert(errorMsg);
								return;
							} else {
								alert("维修信息提交成功！");
							}
						}
					});
		}
	</script>
	<script type="text/javascript">
		function changeTime(timestamp) {
			var newDate = new Date();
			newDate.setTime(timestamp);
			return newDate.toLocaleString();
		}
	</script>

	<script type="text/javascript">
		$(window).on('load', function() {
		    $("#pages").val(1);
			$("#pages2").val(1);
			initMaps();
			initTable();
		});
	</script>
</body>

</html>
